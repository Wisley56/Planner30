<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="manifest_planner.json">
<title>Planner 30 Dias ‚Äî Upgrade</title>
<style>
:root{
  --bg:#f7f7f7; --fg:#222; --card:#ffffff; --muted:#666; --accent:#1f8f3a; --line:#e6e6e6;
}
body.dark{ --bg:#111; --fg:#f2f2f2; --card:#181818; --muted:#aaa; --accent:#35c164; --line:#2a2a2a; }
*{box-sizing:border-box}
body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--fg); margin:0; padding:16px;}
h1{margin:0 0 6px 0;}
.small{color:var(--muted); font-size:13px; margin-bottom:10px;}
.container{max-width:900px; margin:0 auto;}
.box{background:var(--card); padding:14px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); margin:10px 0; border:1px solid var(--line);}
label{display:flex; align-items:center; gap:8px; margin:6px 0;}
input[type="checkbox"]{transform:scale(1.25); accent-color:var(--accent);}
select, input[type="number"], input[type="search"]{width:100%; padding:10px; border-radius:10px; border:1px solid var(--line); background:transparent; color:var(--fg);}
button{background:var(--accent); color:#fff; border:none; padding:12px 14px; border-radius:10px; font-weight:600; cursor:pointer;}
button.ghost{background:transparent; color:var(--accent); border:1px solid var(--accent);}
button:active{opacity:.85}
.row{display:flex; gap:10px; flex-wrap:wrap;}
.col{flex:1 1 240px;}
.toggle{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--line); border-radius:999px; background:var(--card); }
a{color:var(--accent); text-decoration:none;}
.exercise{display:flex; gap:10px; align-items:flex-start; margin:8px 0; border-top:1px dashed var(--line); padding-top:8px;}
.exercise img{width:96px; height:96px; object-fit:cover; border-radius:10px; border:1px solid var(--line); background:#ddd;}
canvas{width:100%; max-width:700px; height:220px; background:var(--card); border-radius:12px; border:1px solid var(--line);}
.timer-grid{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
@media(max-width:680px){ .timer-grid{grid-template-columns:1fr;} }
.nav{display:flex; gap:8px; flex-wrap:wrap; margin:10px 0;}
.hidden{display:none;}
.badge{padding:4px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted);}
</style>
</head>
<body>
<div class="container">
  <div class="row" style="align-items:center; justify-content:space-between;">
    <div>
      <h1>Planner 30 Dias üèãÔ∏è‚Äç‚ôÇÔ∏è</h1>
    </div>
    <div class="toggle">
      <input type="checkbox" id="darkToggle" />
      <label for="darkToggle" style="margin:0">üåô Modo escuro</label>
    </div>
  </div>

  <div class="nav">
    <button id="tabPlanner">üìÖ Planner</button>
    <button id="tabLibrary" class="ghost">üìï Biblioteca</button>
  </div>

  <!-- PLANNER -->
  <section id="plannerView" class="">
    <div class="box row">
      <div class="col">
        <label><b>Dia:</b></label>
        <select id="daySelect"></select>
      </div>
      <div class="col">
        <label><b>Status r√°pido</b></label>
        <label><input type="checkbox" id="treinoFeito"> Treino feito</label>
        <label><input type="checkbox" id="caminhada"> Caminhada 20min</label>
        <label><input type="checkbox" id="alongamento"> Alongamento</label>
      </div>
    </div>

    <div id="exercises" class="box">
      <h2>Exerc√≠cios do Dia</h2>
      <div id="exerciseList"></div>
      <div class="small">Nomes em PT + EN. GIFs com fallback autom√°tico.</div>
    </div>

    <div class="box">
      <h2>Timers ‚è±Ô∏è</h2>
      <div class="timer-grid">
        <div>
          <h3>Descanso entre s√©ries</h3>
          <div class="row">
            <div class="col"><label>Segundos: <input id="restSecs" type="number" min="10" max="300" value="75"></label></div>
          </div>
          <button id="restStart">Iniciar descanso</button>
          <div id="restDisplay" class="small"></div>
        </div>
        <div>
          <h3>Intervalos (HIIT/Cardio)</h3>
          <div class="row">
            <div class="col"><label>Trabalho (s): <input id="workSecs" type="number" min="10" max="120" value="30"></label></div>
            <div class="col"><label>Descanso (s): <input id="easySecs" type="number" min="10" max="180" value="30"></label></div>
            <div class="col"><label>Rodadas: <input id="rounds" type="number" min="1" max="30" value="10"></label></div>
          </div>
          <button id="hiitStart">Iniciar HIIT</button>
          <button id="hiitStop" style="background:#c0392b">Parar</button>
          <div id="hiitDisplay" class="small"></div>
        </div>
      </div>
    </div>

    <div class="box">
      <h2>Notas do Dia</h2>
      <textarea id="notes" rows="6" style="width:100%; border-radius:10px; border:1px solid var(--line); background:transparent; color:var(--fg);" placeholder="Cargas, reps, RPE, sensa√ß√µes..."></textarea>
      <div style="margin-top:8px">
        <button id="saveDay">Salvar dia</button>
      </div>
    </div>

    <div class="box">
      <h2>Progresso üî•</h2>
      <div class="small">Completos por semana (considera checkbox ‚ÄúTreino feito‚Äù por dia).</div>
      <canvas id="progressChart" width="700" height="220"></canvas>
    </div>
  </section>

  <!-- LIBRARY -->
  <section id="libraryView" class="hidden">
    <div class="box">
      <h2>Biblioteca de Exerc√≠cios</h2>
      <div class="row">
        <div class="col"><input id="searchInput" type="search" placeholder="Buscar por nome (EN)"></div>
        <div class="col">
          <select id="filterBody">
            <option value="">Filtrar por regi√£o</option>
          </select>
        </div>
        <div class="col">
          <select id="filterEquip">
            <option value="">Filtrar por equipamento</option>
          </select>
        </div>
      </div>
      <div id="libCount" class="small"></div>
      <div id="libList"></div>
    </div>
  </section>

  <div class="small">PWA: voc√™ pode ‚ÄúAdicionar √† Tela Inicial‚Äù e usar offline. üü¢</div>
</div>

<script>
// ======= Configs =======
const totalDays = 30;
const PLACEHOLDER = "./assets/placeholder.png";

// EX object generated from CSV (dual names + fallback)
const EX = {
  "Agachamento Goblet (dumbbell goblet squat)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/1760.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Supino com Halteres (dumbbell bench press)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/0289.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Remada Curvada Halteres (dumbbell bent over row)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/0293.gif",
    "fallback": "./assets/placeholder.png"
  },
  "RDL (Terra Romeno) (barbell romanian deadlift)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/0085.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Prancha (bodyweight incline side plank)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/3544.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Lunge (Avan√ßo) (barbell lateral lunge)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/1410.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Desenvolvimento Ombros (dumbbell alternate biceps curl)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/0285.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Puxada na Polia (cable lat pulldown full range of motion)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/2330.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Ponte de Gl√∫teos (barbell glute bridge)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/1409.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Dead Bug (dead bug)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/0276.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Flex√£o de Bra√ßos (archer push up)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/3294.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Remada Unilateral (one arm against wall)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/1355.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Farmer Carry (farmers walk)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/2133.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Bike Intervals (exercise ball alternating arm ups)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/1332.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Esteira Inclina√ß√£o (walking on incline treadmill)": {
    "url": "",
    "gif": "https://d205bpvrqc9yn1.cloudfront.net/3666.gif",
    "fallback": "./assets/placeholder.png"
  },
  "Circuito Leve (Jumping Jack)": {
    "url": "",
    "gif": "",
    "fallback": "./assets/placeholder.png"
  }
};

// Mapping daily plan (same estrutura do seu planner)
function dayPlan(day){
  const week = Math.ceil(day/7);
  const dayOfWeek = ((day-1)%7)+1; // 1..7
  const S1 = [
    ["Agachamento Goblet","Supino com Halteres","Remada Curvada Halteres","RDL (Terra Romeno)","Prancha","Esteira Inclina√ß√£o"],
    ["Lunge (Avan√ßo)","Desenvolvimento Ombros","Puxada na Polia","Ponte de Gl√∫teos","Dead Bug","Bike Intervals"],
    ["Agachamento Goblet","RDL (Terra Romeno)","Flex√£o de Bra√ßos","Remada Unilateral","Farmer Carry","Circuito Leve"]
  ];
  const S2 = S1, S3 = S1, S4 = S1;
  const weekPlans = {1:S1,2:S2,3:S3,4:S4};
  const isTrain = [1,3,5].includes(dayOfWeek);
  let block = {isTrain, list:[], note:""};
  if(isTrain){
    const idx = [1,3,5].indexOf(dayOfWeek);
    block.list = weekPlans[week][idx];
    block.note = (week===3||week===4) ? "Semana de intensidade moderada: foque em carga/forma (RPE 6‚Äì8)." :
                (week===2 ? "Semana com leve aumento de volume (+1 s√©rie nos principais)." :
                             "Semana de reentrada: foque na t√©cnica e controle.");
  }else{
    block.note = "Dia livre: caminhada 20‚Äì30min (RPE 4‚Äì6), mobilidade leve e hidrata√ß√£o.";
    block.list = ["Esteira Inclina√ß√£o","Circuito Leve"];
  }
  return block;
}

// ======= UI build =======
const daySelect = document.getElementById("daySelect");
for(let i=1;i<=totalDays;i++){ const opt = document.createElement("option"); opt.value=i; opt.textContent="Dia "+i; daySelect.appendChild(opt); }
if(localStorage.getItem("selDay")) daySelect.value = localStorage.getItem("selDay");

const exerciseList = document.getElementById("exerciseList");
const treinoFeito = document.getElementById("treinoFeito");
const caminhada = document.getElementById("caminhada");
const alongamento = document.getElementById("alongamento");
const notes = document.getElementById("notes");

function renderDay(){
  const d = parseInt(daySelect.value);
  localStorage.setItem("selDay", d);
  [treinoFeito,caminhada,alongamento].forEach(el=>{ el.checked = localStorage.getItem(el.id+"_"+d)==="1"; });
  notes.value = localStorage.getItem("notes_"+d)||"";

  const plan = dayPlan(d);
  exerciseList.innerHTML = "";
  const info = document.createElement("div"); info.className="small"; info.textContent = plan.note; exerciseList.appendChild(info);

  plan.list.forEach(ptName=>{
    // find matching dual key
    const dualKey = Object.keys(EX).find(k => k.toLowerCase().startsWith(ptName.toLowerCase()));
    const data = EX[dualKey] || null;
    let gif = data && data.gif ? data.gif : PLACEHOLDER;
    const row = document.createElement("div");
    row.className="exercise";
    row.innerHTML = `
      <img src="${gif}" alt="${dualKey||ptName}" onerror="this.onerror=null;this.src='${PLACEHOLDER}';">
      <div>
        <div><b>${dualKey || ptName}</b></div>
        <div class="small">Foco t√©cnico ‚Ä¢ RPE 6‚Äì8</div>
      </div>
    `;
    exerciseList.appendChild(row);
  });
  drawChart();
}
daySelect.addEventListener("change", renderDay);

[treinoFeito,caminhada,alongamento].forEach(el=>{
  el.addEventListener("change", ()=>{
    const d = daySelect.value;
    localStorage.setItem(el.id+"_"+d, el.checked?"1":"0");
    drawChart();
  });
});
document.getElementById("saveDay").addEventListener("click", ()=>{
  const d = daySelect.value;
  localStorage.setItem("notes_"+d, notes.value);
  alert("‚úÖ Dia salvo!");
});

// ======= Dark mode =======
const darkToggle = document.getElementById("darkToggle");
if(localStorage.getItem("darkMode")==="1"){ document.body.classList.add("dark"); darkToggle.checked=true; }
darkToggle.addEventListener("change", ()=>{
  if(darkToggle.checked){ document.body.classList.add("dark"); localStorage.setItem("darkMode","1"); }
  else { document.body.classList.remove("dark"); localStorage.setItem("darkMode","0"); }
});

// ======= Timers =======
let restTimer = null;
document.getElementById("restStart").addEventListener("click", ()=>{
  let secs = parseInt(document.getElementById("restSecs").value)||60;
  const disp = document.getElementById("restDisplay");
  clearInterval(restTimer);
  disp.textContent = `Descanso: ${secs}s`;
  restTimer = setInterval(()=>{
    secs--; disp.textContent = `Descanso: ${secs}s`;
    if(secs<=0){ clearInterval(restTimer); disp.textContent="‚úÖ Vamos voltar!"; }
  },1000);
});

let hiitTimer = null, phase="work", round=1, left=0;
const hiitDisplay = document.getElementById("hiitDisplay");
document.getElementById("hiitStart").addEventListener("click", ()=>{
  let work = parseInt(document.getElementById("workSecs").value)||30;
  let easy = parseInt(document.getElementById("easySecs").value)||30;
  let rounds = parseInt(document.getElementById("rounds").value)||8;
  clearInterval(hiitTimer);
  phase="work"; round=1; left=work;
  hiitDisplay.textContent = `Rodada ${round}/${rounds} ‚Ä¢ TRABALHO: ${left}s`;
  hiitTimer = setInterval(()=>{
    left--;
    if(left<=0){
      if(phase==="work"){ phase="easy"; left=easy; hiitDisplay.textContent=`Rodada ${round}/${rounds} ‚Ä¢ LEVE: ${left}s`; }
      else { phase="work"; round++; if(round>rounds){ clearInterval(hiitTimer); hiitDisplay.textContent="‚úÖ HIIT conclu√≠do!"; return; } left=work; hiitDisplay.textContent=`Rodada ${round}/${rounds} ‚Ä¢ TRABALHO: ${left}s`; }
    } else {
      hiitDisplay.textContent = `Rodada ${round}/${rounds} ‚Ä¢ ${phase==="work"?"TRABALHO":"LEVE"}: ${left}s`;
    }
  },1000);
});
document.getElementById("hiitStop").addEventListener("click", ()=>{ clearInterval(hiitTimer); hiitDisplay.textContent="‚è∏Ô∏è Parado"; });

// ======= Progress chart (vanilla canvas) =======
function drawChart(){
  const c = document.getElementById("progressChart");
  const ctx = c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);
  const weeks = [0,0,0,0];
  for(let d=1; d<=30; d++){
    const checked = localStorage.getItem("treinoFeito_"+d)==="1";
    if(checked){
      const w = Math.ceil(d/7)-1; weeks[w]++;
    }
  }
  const maxVal = 3; const barW = 120, gap=30, base=180, x0=40;
  ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--line');
  ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--fg');
  ctx.lineWidth=1.5;
  ctx.beginPath(); ctx.moveTo(30,20); ctx.lineTo(30,base); ctx.lineTo(c.width-10,base); ctx.stroke();
  ctx.font="12px sans-serif";
  for(let i=0;i<=maxVal;i++){
    const y = base - (i/maxVal)*140;
    ctx.fillText(i.toString(), 10, y+4);
    ctx.strokeStyle = 'rgba(128,128,128,0.15)';
    ctx.beginPath(); ctx.moveTo(30,y); ctx.lineTo(c.width-10,y); ctx.stroke();
  }
  for(let i=0;i<4;i++){
    const h = (weeks[i]/maxVal)*140;
    const x = x0 + i*(barW+gap);
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--accent');
    ctx.fillRect(x, base-h, barW, h);
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--fg');
    ctx.fillText("Semana "+(i+1), x+10, base+16);
    ctx.fillText(weeks[i]+"/3", x+barW/2-8, base-h-6);
  }
}

// ======= Library (fetch from exercises.json) =======
const plannerView = document.getElementById("plannerView");
const libraryView = document.getElementById("libraryView");
document.getElementById("tabPlanner").onclick = ()=>{ libraryView.classList.add("hidden"); plannerView.classList.remove("hidden"); };
document.getElementById("tabLibrary").onclick = ()=>{ plannerView.classList.add("hidden"); libraryLoad(); libraryView.classList.remove("hidden"); };

const libList = document.getElementById("libList");
const libCount = document.getElementById("libCount");
const searchInput = document.getElementById("searchInput");
const filterBody = document.getElementById("filterBody");
const filterEquip = document.getElementById("filterEquip");

let LIB = [];
async function libraryLoad(){
  if(LIB.length) return;
  const res = await fetch("./exercises.json");
  LIB = await res.json();
  // fill filters
  const bodies = [...new Set(LIB.map(x=>x.bodyPart))].sort();
  bodies.forEach(b=>{ const o=document.createElement("option"); o.value=b; o.textContent=b; filterBody.appendChild(o); });
  const equips = [...new Set(LIB.map(x=>x.equipment))].sort();
  equips.forEach(e=>{ const o=document.createElement("option"); o.value=e; o.textContent=e; filterEquip.appendChild(o); });
  libraryRender();
}
function libraryRender(){
  const q = (searchInput.value||"").toLowerCase();
  const fb = filterBody.value;
  const fe = filterEquip.value;
  let arr = LIB.filter(x=> (!q || x.name_en.toLowerCase().includes(q)) && (fb=="" || x.bodyPart==fb) && (fe=="" || x.equipment==fe));
  libCount.textContent = arr.length + " exerc√≠cios encontrados";
  libList.innerHTML = "";
  arr.slice(0,400).forEach(x=>{
    const row = document.createElement("div");
    row.className = "exercise";
    row.innerHTML = `
      <img src="${x.gif}" alt="${x.name_en}" onerror="this.onerror=null;this.src='${PLACEHOLDER}';">
      <div>
        <div><b>${x.name_en}</b> <span class="badge">${x.bodyPart}</span> <span class="badge">${x.equipment}</span></div>
        <div class="small">GIF com fallback</div>
      </div>
    `;
    libList.appendChild(row);
  });
}
searchInput.oninput = libraryRender;
filterBody.onchange = libraryRender;
filterEquip.onchange = libraryRender;

// Initial render
renderDay();
drawChart();

// ======= PWA register =======
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./sw_planner_upgraded.js');
  });
}
</script>
</body>
</html>
